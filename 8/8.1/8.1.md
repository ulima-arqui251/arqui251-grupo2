# 8.1. Patrones de Módulo

[Volver al índice](../8.md)

---

## ADR 1: Aplicación del Patrón Modular Monolith

### Contexto

StudyMate requiere una arquitectura que permita desarrollo ágil por un equipo pequeño, pero que también prepare el terreno para futuras transiciones a microservicios. El sistema cuenta con 8 módulos funcionales claramente diferenciados (Autenticación, Lecciones, Gamificación, Comunidad, Premium, Docente, Institucional, Admin Contenido) que necesitan estar bien separados pero coordinados.

### Alternativas Consideradas

1. **Patrón Modular Monolith**
   - Estructura por dominios funcionales con interfaces bien definidas
   - Separación lógica clara entre módulos
   - Base de datos compartida pero con esquemas por dominio
   - Preparación para extracción de microservicios

2. **Arquitectura en Capas Tradicional**
   - Organización horizontal (presentación, lógica, datos)
   - Menor separación por dominio
   - Más acoplamiento entre funcionalidades

3. **Microservicios desde el inicio**
   - Complejidad operacional alta para un equipo pequeño
   - Mayor overhead de comunicación

### Criterios de Elección

- Cumplimiento de escenarios de rendimiento (ESC-03: 500 usuarios concurrentes ≤ 300ms)
- Facilidad de desarrollo y mantenimiento para equipo pequeño
- Preparación para evolución arquitectónica futura
- Separación clara de responsabilidades por módulo

### Decisión

Se adopta el **Patrón Modular Monolith** con estructura por dominios funcionales.

### Sustento

Esta decisión permite:
- **Cumplir ESC-06** (1000 usuarios simultáneos): Un solo despliegue optimizado es más eficiente que múltiples servicios
- **Facilitar ESC-04** (Mantenibilidad 2FA): Cambios en un módulo no afectan otros
- **Preparar escalabilidad futura**: Interfaces bien definidas permiten extracción a microservicios
- **Desarrollo ágil**: Equipo pequeño puede trabajar en módulos independientes sin overhead de red

---

## Descripción de Aplicación en StudyMate

### Estructura Modular Implementada

```
backend/
├── auth-service/           # Módulo de Autenticación
│   ├── controllers/
│   ├── services/
│   ├── models/
│   └── routes/
├── lesson-service/         # Módulo de Lecciones
├── gamification-service/   # Módulo de Gamificación
├── community-service/      # Módulo de Comunidad
├── premium-service/        # Módulo Premium
├── teacher-service/        # Módulo Docente
├── institutional-service/  # Módulo Institucional
└── content-admin-service/  # Módulo Admin Contenido
```

### Interfaces Entre Módulos

Cada módulo expone interfaces claras:

```typescript
// Ejemplo: Interface del módulo de gamificación
interface GamificationService {
  awardPoints(userId: string, action: string, points: number): Promise<void>;
  updateLevel(userId: string): Promise<UserLevel>;
  getLeaderboard(limit: number): Promise<LeaderboardEntry[]>;
}
```

### Beneficios Obtenidos

1. **Rendimiento Optimizado**: 
   - ESC-03: Autenticación concurrente sin degradación (≤ 300ms)
   - ESC-21: Recomendaciones inteligentes (≤ 500ms)

2. **Mantenibilidad Mejorada**:
   - ESC-04: Actualizaciones de 2FA sin interrumpir servicio
   - ESC-36: Validación de contenido con errores claros

3. **Escalabilidad Preparada**:
   - ESC-13: 10,000 usuarios suben de nivel simultáneamente
   - Módulos listos para extracción independiente

### Patrones Complementarios

- **Module Interface Pattern**: Cada módulo expone solo las operaciones necesarias
- **Shared Kernel Pattern**: Base de datos y utilidades comunes compartidas
- **Anti-Corruption Layer**: Interfaces que protegen la integridad de cada módulo

---

## ADR 2: Aplicación del Patrón Backends for Frontends (BFF) - Preparación

### Contexto

StudyMate tiene tres tipos principales de usuarios con necesidades muy diferentes:
- **Estudiantes**: Necesitan interfaces rápidas, móviles, gamificadas
- **Docentes**: Requieren herramientas de gestión y seguimiento académico
- **Administradores**: Necesitan dashboards completos y herramientas de configuración

### Alternativas Consideradas

1. **API Gateway Único**
   - Una sola API para todos los tipos de usuario
   - Respuestas genéricas que los frontends adaptan
   - Menor complejidad inicial

2. **Backends for Frontends (BFF)**
   - Un backend especializado por tipo de frontend
   - Respuestas optimizadas por contexto de uso
   - Mayor complejidad pero mejor experiencia

### Criterios de Elección

- Cumplimiento de ESC-09: Navegación ≤ 2 seg
- Optimización por tipo de dispositivo y usuario
- Preparación para crecimiento futuro

### Decisión

Se prepara la arquitectura para **evolución hacia BFF**, implementando inicialmente un API Gateway con capacidad de especialización futura.

### Sustento

- **Cumple ESC-09**: Respuestas optimizadas por frontend mejoran navegación
- **Prepara ESC-20**: Panel docente puede escalar independientemente
- **Facilita ESC-25**: Simulaciones premium pueden tener backend dedicado

### Aplicación Futura en StudyMate

```
Frontends:
├── student-app/     → Student BFF (optimizado para móviles)
├── teacher-panel/   → Teacher BFF (herramientas de gestión)
└── admin-panel/     → Admin BFF (dashboards complejos)

Backends (Futura evolución):
├── student-bff/     → API optimizada para estudiantes
├── teacher-bff/     → API optimizada para docentes
└── admin-bff/       → API optimizada para administradores
```

Esta preparación permite migrar gradualmente sin romper la funcionalidad existente.